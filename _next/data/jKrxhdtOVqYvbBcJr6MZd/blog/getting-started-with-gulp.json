{"pageProps":{"post":{"title":"Getting started with Gulp","date":"2014-04-12T00:00:00.000Z","slug":"getting-started-with-gulp","content":"<h1>Getting started with Gulp</h1>\n<p>This is the first in a short series about setting up a sane gulpfile that works for development and production.</p>\n<p>Having recently switched from Grunt, I find Gulp to be easier to use and maintain, and I want to share what I’ve learned so far.</p>\n<h2>Initial setup</h2>\n<p>This guide assumes you already have <a href=\"http://nodejs.org/\">nodejs</a> installed. There should also be a ‘package.json’ in your root application directory, which can be created using <code>npm init</code>. From there, gulp should be installed globally using npm <code>install -g gulp</code> and inside of our project dependencies using <code>npm install --save-dev gulp</code>.</p>\n<p>Our first gulpfile will be simple and I will use it to introduce several important plugins.</p>\n<h2>Plugins</h2>\n<p>Install the following gulp plugins using npm <code>npm install --save-dev &#x3C;plugin></code></p>\n<p><a href=\"https://github.com/sindresorhus/gulp-changed\">gulp-changed</a> - Run tasks on changed files only.<br>\n<a href=\"https://github.com/peter-vilja/gulp-clean\">gulp-clean</a> - Clean up build artifacts.<br>\n<a href=\"https://github.com/avevlad/gulp-connect\">gulp-connect</a> - Development http server with live reload.<br>\n<a href=\"https://github.com/jackfranklin/gulp-load-plugins\">gulp-load-plugins</a> - Easily load all gulp plugins.<br>\n<a href=\"https://github.com/stevelacy/gulp-open\">gulp-open</a> - Open browser automatically.<br>\n<a href=\"https://github.com/floatdrop/gulp-plumber\">gulp-plumber</a> - Monkey patch to fix stream piping being stopped by errors. Useful for development.<br>\n<a href=\"https://github.com/OverZealous/run-sequence\">run-sequence</a> - As of today, this functionality still doesn’t seem to be implemented in gulp. Check out <a href=\"https://github.com/orchestrator/orchestrator/issues/21\">https://github.com/orchestrator/orchestrator/issues/21</a> for more information.<br>\n<a href=\"http://lodash.com/\">lodash</a> - Some utility functions. Also an awesome library.  </p>\n<h2>File structure</h2>\n<p>There is an assumption about file structure. My app structure is diagramed below, adjust your gulpfile accordingly.</p>\n<pre><code>app/\n    views/\n    scripts/\n    styles/\n    images/\n    index.html\nbuild/\ngulpfile.js\npackage.json\n</code></pre>\n<h2>Gulpfile</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> gulp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nlp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-load-plugins'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// automatically load our plugins</span>\n_ <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lodash'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>Start by requiring the plugins and modules we need. gulp-load-plugins will load plugins and return an object that contains them. For example, gulp-changed will be assigned to <code>lp.changed</code>, the ‘gulp-’ prefix is removed automatically.</p>\n<h2>Utility functions</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p1<span class=\"token punctuation\">,</span> p2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">isArray</span><span class=\"token punctuation\">(</span>p2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">map</span><span class=\"token punctuation\">(</span>p2<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">partial</span><span class=\"token punctuation\">(</span>join<span class=\"token punctuation\">,</span> p1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">,</span> p2 <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> appPath <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">partial</span><span class=\"token punctuation\">(</span>join<span class=\"token punctuation\">,</span> <span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> buildPath <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">partial</span><span class=\"token punctuation\">(</span>join<span class=\"token punctuation\">,</span> <span class=\"token string\">'build'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>I like to write some helper functions for easy path creation. Take advantage of the path module in node, along with lodash’s ability to partially apply functions. join is now a function that takes a path, p1, and can join it with either an array of paths (in which case it will be mapped to each one) or a single path.</p>\n<p><code>appPath()</code> and <code>buildPath()</code> can be used to easily set up configuration settings. The views, for example, would be located at <code>appPath('views')</code> which evaluates to ‘app/views’.</p>\n<h2>Configuration</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  httpPort<span class=\"token punctuation\">:</span> <span class=\"token string\">'9000'</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// views</span>\n  srcViews<span class=\"token punctuation\">:</span> <span class=\"token function\">appPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/**/*.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  destViews<span class=\"token punctuation\">:</span> <span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  srcIndex<span class=\"token punctuation\">:</span> <span class=\"token function\">appPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// this will be more useful in the future</span>\n\n  <span class=\"token comment\">// styles</span>\n  srcStyles<span class=\"token punctuation\">:</span> <span class=\"token function\">appPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styles/**/*.css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  destStyles<span class=\"token punctuation\">:</span> <span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styles'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// scripts</span>\n  srcScripts<span class=\"token punctuation\">:</span> <span class=\"token function\">appPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'scripts/*.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scripts/*/*.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scripts/**/*.js'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// There is reason to this madness, will explain.</span>\n  destScripts<span class=\"token punctuation\">:</span> <span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scripts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// images</span>\n  srcImages<span class=\"token punctuation\">:</span> <span class=\"token function\">appPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'images/**/*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// supply extensions if you desire</span>\n  destImages<span class=\"token punctuation\">:</span> <span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'images'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>An object to hold all build configuration. This is pretty straightforward, but we want to define all inputs and outputs so they can be changed from one place.</p>\n<p>You may notice srcScripts seems unnecessarily complex. This is just to process files in a specific order. While it doesn’t matter now, this will be useful in the future. Scripts in ‘app/scripts’ first, all subdirectories in ‘app/scripts’, and then the remaining directories recursively.</p>\n<h2>Build tasks</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styles'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">src</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcStyles</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">changed</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destStyles</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dest</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destStyles</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token property-access\">connect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ngulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scripts'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">src</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcScripts</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">changed</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destScripts</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dest</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destScripts</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token property-access\">connect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ngulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'images'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">src</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcImages</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">changed</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destImages</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dest</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destImages</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token property-access\">connect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ngulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'views'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">src</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcViews</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">changed</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destViews</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dest</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">destViews</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token property-access\">connect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ngulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'styles'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'scripts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">src</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcIndex</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">plumber</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">dest</span><span class=\"token punctuation\">(</span><span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token property-access\">connect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>All of our basic build tasks come next. The second argument when defining a task can be an array of dependencies. Here, the ‘index’ task depends on ‘styles’ and ‘scripts’. These two tasks will be executed concurrently before the main task, ‘index’, gets run. This comes in handy with more complex gulpfiles.</p>\n<p>A few interesting plugins are being used here.\n<a href=\"https://github.com/floatdrop/gulp-plumber\">gulp-plumber</a>, used as <code>lp.plumber()</code>, prevents our tasks from stopping when an error occurs. Without this gulp would die if an error occurred in one of the tasks invoked by a watch. Some tasks, such as Sass compilation, simply need to be rerun and aren’t fatal. This eases the development process by preventing interruptions.</p>\n<p>The live-reload feature of <a href=\"https://github.com/avevlad/gulp-connect\">gulp-connect</a>. You can pipe files to <code>lp.connect.reload()</code> and trigger gulp-connect to send a live-reload message to the browser. This message will only contain the piped files.</p>\n<p><a href=\"https://github.com/sindresorhus/gulp-changed\">gulp-changed</a>, will compare piped files to the specified output path, and filter out all files that haven’t changed. It optimizes the build process in development by not rebuilding files that have remained the same.</p>\n<p><code>gulp.dest()</code> is built into gulp and simply writes the piped files to disk.</p>\n<h2>Cleanup</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clean'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">src</span><span class=\"token punctuation\">(</span><span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>read<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">pipe</span><span class=\"token punctuation\">(</span>lp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">clean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>gulp-clean will delete our ‘build/’ directory. By passing {read: false} to <code>gulp.src()</code>, we tell gulp that we don’t want to read the content of the files. File names are enough to delete a file.</p>\n<h2>Watching for changes</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'watch'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watch</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcStyles</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'styles'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watch</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcViews</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'views'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watch</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcImages</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'images'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watch</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcScripts</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'scripts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">watch</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span><span class=\"token property-access\">srcIndex</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>watch is built into gulp. It will monitor files for changes, and execute one or more tasks. Our tasks watches all project files and runs the rebuild tasks when they are altered.</p>\n<h2>Building</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'clean'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">runSequence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'images'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'views'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>build is a collection of tasks. First it will run ‘clean’, then it will run ‘index’, ‘images’, and ‘views’ concurrently. This builds everything we need to have a working version of the application in ‘build/’.</p>\n<h2>Starting a server</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'server'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  lp<span class=\"token punctuation\">.</span><span class=\"token property-access\">connect</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">server</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    root<span class=\"token punctuation\">:</span> <span class=\"token function\">buildPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    port<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token property-access\">httpPort</span><span class=\"token punctuation\">,</span>\n    livereload<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>server will start up the <a href=\"https://github.com/torifat/gulp-connect-multi\">gulp-connect</a> http server and use the ‘build/’ directory to serve files.</p>\n<h2>Wrapping it all up</h2>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'build'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">runSequence</span><span class=\"token punctuation\">(</span><span class=\"token string\">'server'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'watch'</span><span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>Finally, the ‘default’ task will build and start a server automatically. It can be run by simply typing <code>gulp</code>.</p>\n<p><code>run-sequence()</code> let’s us ensure that ‘server’ and ‘watch’ are executed sequentially. The key difference from the first time we saw it is passing an array of strings, as opposed to multiple string parameters. While not currently possible in Gulp, this feature seems to be on the roadmap as seen here <a href=\"https://github.com/orchestrator/orchestrator/issues/21\">https://github.com/orchestrator/orchestrator/issues/21</a>.</p>\n<p>All tasks can be executed independently using <code>gulp &#x3C;taskname></code>.</p>\n<p>That should be enough to get you going. The final result should look something like this.</p>\n<p><a href=\"https://gist.github.com/voxtex/11239483\">https://gist.github.com/voxtex/11239483</a></p>\n<p>The following comments are inevitable, so I will respond before they come up.</p>\n<blockquote>\n<p>There’s no point to copying the files, they aren’t modified.</p>\n</blockquote>\n<p>Correct. It serves no purpose right now, but eventually we will be compiling from Sass and Slim, and performing minification and concatenation. We need to ouput the processed files to some isolated directory.</p>\n<blockquote>\n<p>There’s no point in using runSequence() for the build task, as those items are concurrent anyway.</p>\n</blockquote>\n<p>Also correct. They could simply be defined as dependencies on the task. It was more to illustrate usage of runSequence(), and will be important later on.</p>\n<p>In future posts, I will work on building out the tasks to include typical web development functionality. Sass, Slim, JSHint, and minification will be included along with a bit more.</p>\n<p>If you have any suggestions or improvements be sure to comment and let me know.</p>"}},"__N_SSG":true}